/**
 * @author  Lyca,qmzmxfy@vip.qq.com
**/
;(function($){
	$.fn.extend({
    popHide:function(){
      this.hide().find('.pop-close').off('click');
      $(window).off("resize.popResize scroll.popScroll");
      if(this.data('mask')){
        this.data('mask').remove();
        $(window).off("resize.maskResize scroll.maskScroll");  
      }
      return this;
    },
		popShow:function(group){
      /* 默认参数 */
      group = $.extend({
				width:this.outerWidth(true),                            //弹层宽
				height:this.outerHeight(true),                          //弹层高
				x:"center",                                             //横坐标
				y:"center",                                             //纵坐标
				anyClose:false,                                         //点击遮罩关闭弹层
				mask:$('#pop-mask[data-pop="mask"]').length?false:true, //遮罩
				maskBg:"#000",                                          //遮罩颜色
				maskO:"0.6"                                             //遮罩透明度
			},group);
			var IE6 = !-[1,]&&!window.XMLHttpRequest,
          $this = this,
          popPosition = function(){
            var wW = $(window).width(), 
                wH = $(window).height(),
                w = group.width,
                h = group.height,
                x = group.x,
                y = group.y,
                L = x,
                T = y,
                R = 'auto',
                B = 'auto';
            if(typeof(x)=='object'){
              L = x.left||'auto';
              R = x.right||R;
            }else if('centermiddle'.indexOf(x)!=-1){
              L = (wW-(parseInt(w)))/2+(IE6?$(document).scrollLeft():0);
            }
            $this.css({
              position:IE6?'absolute':'fixed',
              left:L,
              right:R
            });
            if(typeof(y)=='object'){
              T = y.top||(IE6?(wH-parseInt(h)-parseInt(y.bottom)):'auto');
              B = y.bottom&&!IE6?y.bottom:B;
            }else if('centermiddle'.indexOf(y)!=-1){
              T = (wH-(parseInt(h)))/2+(IE6?$(document).scrollTop():0);
            }
            if(IE6){
              $this.stop().animate({top:T},'fast');
            }else{
              $this.css({
                top:T,
                bottom:B
              });
            }
          };
      /* 写入遮罩 */
			if(group.mask){
        var $mask =  null,
            $maskIf =  null,
            $maskAll =  null,
            $maskIfDoc = null,
            maskSize = function(){
              $maskAll.width($(window).width()+$(document).scrollLeft()).height($(window).height()+$(document).scrollTop());
            };
				$("body").append('<div id="pop-mask" data-pop="mask">'+(IE6?'<iframe id="pop-mask-if" frameborder="0" scrolling="no"></iframe>':'')+'</div>');
				$mask = $('#pop-mask');
        $maskIf = $('#pop-mask-if');
        $maskAll = $('#pop-mask,#pop-mask-if');
        $maskIfDoc = IE6?$(window.frames['pop-mask-if'].document):null;
				$maskAll.css({
					position:'absolute',
          top:0,left:0,
					background:group.maskBg,
					opacity:group.maskO,
					zIndex:1e+7
				});
        if(IE6){
          $mask.css({
            background:'none',
					  opacity:1
          });
          $maskIf.css({
            zIndex:-1
          });
          setTimeout(function(){
            $maskIfDoc.find('html').css({
              background:group.maskBg
            });
          },0); 
        }
        maskSize();
        /* 绑定窗口变化&&绑定滚动条 */
        $(window).on("resize.maskResize scroll.maskScroll",function(){
          maskSize();
        });
        /* 点击遮罩关闭弹层 */
        if(group.anyClose){
          $mask.on('click',function(){
            $this.popHide();
          });
          if(IE6){
            $maskIfDoc.on('click',function(){
              $this.popHide();
            });    
          }
        }
			}
      /* 配置弹层位置 */
			popPosition();
			/* 显示弹层 */
			$this.css({"z-index":1.1e+8}).data('mask',$mask).show();
      /* 绑定窗口变化 */
			$(window).on("resize.popResize",function(){
				popPosition();
			});
      /* 绑定滚动条 */
      if(IE6){
        $(window).on("scroll.popScroll",function(){
          popPosition();
        });
      }
      /* 默认class关闭弹层 */
      $this.on('click','.pop-close',function(){
        $this.popHide();
      });
      /* 返回操作对象 */
      return this;
		},
    popAlert:function(v,h,btn,group){
      var $popAlert = $('#pop-alert');
      if($popAlert.length===0){
        $('body').append('<div class="pop-alert clearfix" id="pop-alert"><div class="pop-alert-hd clearfix"><p class="pop-alert-title fl"></p><a class="pop-close fr" href="javascript:;"></a></div><div class="pop-alert-bd clearfix"><div class="pop-alert-tips" id="pop-alert-tips"></div></div><div id="pop-alert-btn"></div></div>');
        $('head').append('<style>.pop-alert{display:none;width:450px;background:#FFF}.pop-alert-hd{width:100%;height:40px;background:#888;line-height:40px}.pop-alert-hd p{padding-left:20px;font-size:14px;color:#FFF}.pop-alert-hd a{display:inline-block;margin-top:10px;margin-right:10px;width:21px;height:21px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVAQMAAACT2TfVAAAABlBMVEX///////9VfPVsAAAAAXRSTlMAQObYZgAAADpJREFUGNMtyKENwDAMADC3KgjMCTklJ+ykwJ49sCFLNkJLpaQWxlnszTq4eFC/9/u9OYswUiulpREv89oFzZOVV/EAAAAASUVORK5CYII=");transition:all .3s ease-out 0s;-webkit-transition:all .3s ease-out 0s}.pop-alert-hd a:hover{transform:rotate(180deg);-webkit-transform:rotate(180deg)}.pop-alert-btn{margin:0 auto;padding-bottom:15px;width:100px}.pop-alert-btn2{width:200px}.pop-alert-btn3{width:300px}.pop-alert-btn input,.pop-alert-btn a{display:inline-block;margin:0 10px;width:80px;height:30px;border:0;font-size:12px;color:#FFF;cursor:pointer;text-align:center;text-decoration:none}.pop-alert-btn a{line-height:30px}.pop-alert-btn input:hover,.pop-alert .pop-alert-btn a:hover{box-shadow:#c5c5c5 2px 2px 4px}.pop-alert-btn-radius{border-radius:4px}.pop-alert-btn-a{background:#7e7e7e;background:-webkit-gradient(linear,0 0,0 100%,from(#969696),to(#7e7e7e));background:-moz-linear-gradient(top,#969696,#7e7e7e)}.pop-alert-btn-b{background:#a1a1a1;background:-webkit-gradient(linear,0 0,0 100%,from(#b6b6b6),to(#a1a1a1));background:-moz-linear-gradient(top,#b6b6b6,#a1a1a1)}.pop-alert-btn-c{background:#0080d3;background:-webkit-gradient(linear,0 0,0 100%,from(#008eea),to(#0080d3));background:-moz-linear-gradient(top,#008eea,#0080d3)}.pop-alert-btn-d{background:#6aae4e;background:-webkit-gradient(linear,0 0,0 100%,from(#79c765),to(#6aae4e));background:-moz-linear-gradient(top,#79c765,#6aae4e)}.pop-alert-btn-e{background:#ed680c;background:-webkit-gradient(linear,0 0,0 100%,from(#f19812),to(#ed680c));background:-moz-linear-gradient(top,#f19812,#ed680c)}.pop-alert-tips {padding:40px 20px;font-size:16px;line-height:24px;color:#333;text-align:center;word-break:break-all;}</style>');
        $popAlert = $('#pop-alert');
      }
      var btnHtml = [];
      btn = btn||[{}];
      $.each(btn,function(i,e){
        e = $.extend({
          classname:'pop-alert-btn-a pop-close',
          txt:'\u786e\u5b9a',
          event:'click'
        },e);
        btnHtml[i] = '<input id="pop-alert-btn'+i+'" class="fl '+e.classname+'" type="button" value="'+e.txt+'">';
        $popAlert.off(e.event,'#pop-alert-btn'+i).on(e.event,'#pop-alert-btn'+i,function(){
          if(e.callback){e.callback();}
        });
      });
      var content = typeof(v)=='object'?[v[0],v[1]]:[v,''];
      $popAlert.find('.pop-alert-title').html(h||'\u63d0\u793a').end().find('#pop-alert-tips').attr('class','pop-alert-tips '+content[1]).html(content[0]).end().find('#pop-alert-btn').html(btnHtml).attr('class','pop-alert-btn clearfix pop-alert-btn'+btn.length).end().popShow(group); 
    },
    popAlertHide:function(){
      $('#pop-alert').popHide();
    }
	});
})(jQuery);